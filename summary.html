<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Booking Summary</title>
<style>
body{font-family:'Poppins',sans-serif; background:#e0f7fa; display:flex; justify-content:center; align-items:center; min-height:100vh; padding:20px;}
main{background:#fff; padding:2rem; border-radius:12px; max-width:800px; width:100%; box-shadow:0 8px 20px rgba(0,0,0,0.1);}
h1{color:#0a6b3b; text-align:center; margin-bottom:1rem;}
.summary p{margin:10px 0;}
button{padding:12px 18px; margin:5px; border:none; border-radius:8px; cursor:pointer; color:white;}
#printBtn{background:#0a6b3b;}
#visaBtn{background:#2a8a55;}
#csvBtn{background:#f44336;}
</style>
</head>
<body>
<main>
<h1>Booking Summary</h1>
<div class="summary" id="summary">
<p><strong>Booking Number:</strong> <span id="summary-booking_reference">—</span></p>
<p><strong>ID Number:</strong> <span id="summary-id_number">—</span></p>
<p><strong>Forenames:</strong> <span id="summary-forenames">—</span></p>
<p><strong>Surname:</strong> <span id="summary-surname">—</span></p>
<p><strong>Cellphone:</strong> <span id="summary-cellphone">—</span></p>
<p><strong>Email:</strong> <span id="summary-email">—</span></p>
<p><strong>Appointment Date:</strong> <span id="summary-appointment_date">—</span></p>
<p><strong>Appointment Time:</strong> <span id="summary-appointment_time">—</span></p>
</div>
<div>
<button id="printBtn" onclick="window.print()">Print Summary</button>
<button id="visaBtn" onclick="location.href='visa-application.html'">Visa Application</button>
<button id="csvBtn" onclick="downloadCSV()">Download CSV</button>
</div>

<script>
window.onload=function(){
  const bookingData=JSON.parse(localStorage.getItem("bookingData"));
  if(!bookingData){ alert("No booking data found."); return; }
  document.getElementById("summary-booking_reference").textContent=bookingData.booking_reference;
  document.getElementById("summary-id_number").textContent=bookingData.id_number;
  document.getElementById("summary-forenames").textContent=bookingData.forenames;
  document.getElementById("summary-surname").textContent=bookingData.surname;
  document.getElementById("summary-cellphone").textContent=bookingData.cellphone;
  document.getElementById("summary-email").textContent=bookingData.email;
  document.getElementById("summary-appointment_date").textContent=bookingData.appointment_date;
  document.getElementById("summary-appointment_time").textContent=bookingData.appointment_time;
};

// CSV Download
function downloadCSV(){
  const allBookings=JSON.parse(localStorage.getItem("allBookings")||"{}");
  if(!allBookings || Object.keys(allBookings).length===0){ alert("No bookings to download."); return; }
  const headers=["Booking Number","ID Number","Forenames","Surname","Cellphone","Email","Appointment Date","Appointment Time"];
  const rows=[headers.join(",")];
  Object.values(allBookings).forEach(b=>{
    rows.push([b.booking_reference,b.id_number,b.forenames,b.surname,b.cellphone,b.email,b.appointment_date,b.appointment_time].join(","));
  });
  const csvContent="data:text/csv;charset=utf-8,"+rows.join("\n");
  const encodedUri=encodeURI(csvContent);
  const link=document.createElement("a");
  link.setAttribute("href",encodedUri);
  link.setAttribute("download","bookings.csv");
  document.body.appendChild(link); link.click(); document.body.removeChild(link);
}
</script>
</body>
</html>
