<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
  const countryLocations = {
    'Eswatini': ['Mbabane', 'Manzini', 'Lobamba'],
    'South Africa': ['Pretoria', 'Johannesburg', 'Cape Town'],
    'Kenya': ['Nairobi', 'Mombasa', 'Kisumu'],
    'Ghana': ['Accra', 'Kumasi', 'Tamale'],
    'Nigeria': ['Lagos', 'Abuja', 'Port Harcourt'],
  };

  const officeLocations = {
    'Mbabane': ['Main Office', 'Regional Office 1', 'Regional Office 2'],
    'Manzini': ['Main Office', 'Branch 1', 'Branch 2'],
    'Lobamba': ['Main Office'],
    'Pretoria': ['Main Office', 'Branch 1', 'Branch 2'],
    'Johannesburg': ['Main Office', 'Branch 1'],
    'Cape Town': ['Main Office'],
    'Nairobi': ['Main Office', 'Branch 1'],
    'Mombasa': ['Main Office'],
    'Kisumu': ['Branch 1'],
    'Accra': ['Main Office', 'Branch 1'],
    'Kumasi': ['Branch 1'],
    'Tamale': ['Branch 1'],
    'Lagos': ['Main Office', 'Branch 1', 'Branch 2'],
    'Abuja': ['Main Office'],
    'Port Harcourt': ['Branch 1'],
  };

  function updateLocations() {
    const country = document.getElementById('country').value;
    const locationSelect = document.getElementById('location');
    const officeSelect = document.getElementById('office');

    locationSelect.innerHTML = '<option value="">Select Location</option>';
    officeSelect.innerHTML = '<option value="">Select Office</option>';

    if (countryLocations[country]) {
      countryLocations[country].forEach(location => {
        const option = document.createElement('option');
        option.value = location;
        option.textContent = location;
        locationSelect.appendChild(option);
      });
    }
  }

  function updateOffices() {
    const location = document.getElementById('location').value;
    const officeSelect = document.getElementById('office');
    officeSelect.innerHTML = '<option value="">Select Office</option>';

    if (officeLocations[location]) {
      officeLocations[location].forEach(office => {
        const option = document.createElement('option');
        option.value = office;
        option.textContent = office;
        officeSelect.appendChild(option);
      });
    }
  }

  const disabledDateRanges = [
    { from: "2025-09-01", to: "2025-10-16" }
  ];

  const publicHolidays = [
    "2025-09-24",
    "2025-10-15",
    "2025-10-23"
  ];

  function disableDates(date) {
    const dateStr = date.toISOString().split('T')[0];

    // Disable weekends (Saturday: 6, Sunday: 0)
    if (date.getDay() === 0 || date.getDay() === 6) {
      return true;
    }

    // Disable date ranges
    for (const range of disabledDateRanges) {
      if (dateStr >= range.from && dateStr <= range.to) {
        return true;
      }
    }

    // Disable public holidays
    if (publicHolidays.includes(dateStr)) {
      return true;
    }

    return false;
  }

  // Highlight disabled dates in red
  flatpickr("#appointment_date", {
    dateFormat: "Y-m-d",
    minDate: "today",
    disable: [disableDates],
    onDayCreate: function(dObj, dStr, fp, dayElem) {
      const date = dayElem.dateObj;
      const dateStr = date.toISOString().split('T')[0];

      let isDisabled = false;

      if (date.getDay() === 0 || date.getDay() === 6) {
        isDisabled = true;
      }

      for (const range of disabledDateRanges) {
        if (dateStr >= range.from && dateStr <= range.to) {
          isDisabled = true;
        }
      }

      if (publicHolidays.includes(dateStr)) {
        isDisabled = true;
      }

      if (isDisabled) {
        dayElem.style.color = "#f44336"; // red
      }
    }
  });

  document.getElementById("bookingForm").addEventListener("submit", function (e) {
    e.preventDefault();

    if (!this.checkValidity()) {
      return; // Silently prevent submission if form is invalid
    }

    const bookingData = {
      id_number: document.getElementById("id_number").value,
      forenames: document.getElementById("forenames").value,
      surname: document.getElementById("surname").value,
      country: document.getElementById("country").value,
      location: document.getElementById("location").value,
      office: document.getElementById("office").value,
      appointment_date: document.getElementById("appointment_date").value,
      appointment_time: document.getElementById("appointment_time").value,
    };

    localStorage.setItem("bookingData", JSON.stringify(bookingData));
    window.location.href = "summary.html";
  });
</script>
