<script>
const bookingForm = document.getElementById("bookingForm");

// Function to validate fields
function validateForm() {
  let valid = true;

  // Check all required input/select fields
  const requiredFields = bookingForm.querySelectorAll("[required]");
  requiredFields.forEach(field => {
    if (!field.value.trim()) {
      field.style.border = "2px solid red";
      valid = false;
    } else {
      field.style.border = "1px solid #ccc";
    }
  });

  return valid;
}

// Handle form submission
bookingForm.addEventListener("submit", function(e) {
  e.preventDefault();

  if (validateForm()) {
    // Gather booking data
    const bookingData = {
      id_number: document.getElementById("id_number").value,
      forenames: document.getElementById("forenames").value,
      surname: document.getElementById("surname").value,
      country: document.getElementById("country").value,
      location: document.getElementById("location").value,
      office: document.getElementById("office").value,
      appointment_date: document.getElementById("appointment_date").value,
      appointment_time: document.getElementById("appointment_time").value,
    };

    // Save to localStorage
    localStorage.setItem("bookingData", JSON.stringify(bookingData));

    // Redirect to summary page
    window.location.href = "summary.html";
  } else {
    // Scroll to first invalid field
    const firstInvalid = bookingForm.querySelector("input[style*='red'], select[style*='red']");
    firstInvalid?.scrollIntoView({ behavior: "smooth", block: "center" });
  }
});

// Keep your location/office dropdown logic intact
const countryLocations = {
  'Eswatini': ['Mbabane', 'Manzini', 'Lobamba'],
  'South Africa': ['Pretoria', 'Johannesburg', 'Cape Town'],
  'Kenya': ['Nairobi', 'Mombasa', 'Kisumu'],
  'Ghana': ['Accra', 'Kumasi', 'Tamale'],
  'Nigeria': ['Lagos', 'Abuja', 'Port Harcourt'],
};

const officeLocations = {
  'Mbabane': ['Main Office', 'Regional Office 1', 'Regional Office 2'],
  'Manzini': ['Main Office', 'Branch 1', 'Branch 2'],
  'Lobamba': ['Main Office'],
  'Pretoria': ['Main Office', 'Branch 1', 'Branch 2'],
  'Johannesburg': ['Main Office', 'Branch 1'],
  'Cape Town': ['Main Office'],
  'Nairobi': ['Main Office', 'Branch 1'],
  'Mombasa': ['Main Office'],
  'Kisumu': ['Branch 1'],
  'Accra': ['Main Office', 'Branch 1'],
  'Kumasi': ['Branch 1'],
  'Tamale': ['Branch 1'],
  'Lagos': ['Main Office', 'Branch 1', 'Branch 2'],
  'Abuja': ['Main Office'],
  'Port Harcourt': ['Branch 1'],
};

function updateLocations() {
  const country = document.getElementById('country').value;
  const locationSelect = document.getElementById('location');
  const officeSelect = document.getElementById('office');

  locationSelect.innerHTML = '<option value="">Select Location</option>';
  officeSelect.innerHTML = '<option value="">Select Office</option>';

  if (countryLocations[country]) {
    countryLocations[country].forEach(location => {
      const option = document.createElement('option');
      option.value = location;
      option.textContent = location;
      locationSelect.appendChild(option);
    });
  }
}

function updateOffices() {
  const location = document.getElementById('location').value;
  const officeSelect = document.getElementById('office');
  officeSelect.innerHTML = '<option value="">Select Office</option>';

  if (officeLocations[location]) {
    officeLocations[location].forEach(office => {
      const option = document.createElement('option');
      option.value = office;
      option.textContent = office;
      officeSelect.appendChild(option);
    });
  }
}

// Flatpickr datepicker
flatpickr("#appointment_date", {
  dateFormat: "Y-m-d",
  minDate: "today",
  disable: [
    function(date) {
      const dateStr = date.toISOString().split('T')[0];
      const disabledRanges = [{ from: "2025-09-01", to: "2025-10-16" }];
      const holidays = ["2025-09-24","2025-10-15","2025-10-23"];

      for (const range of disabledRanges) {
        if (dateStr >= range.from && dateStr <= range.to) return true;
      }
      return holidays.includes(dateStr);
    }
  ]
});
</script>
