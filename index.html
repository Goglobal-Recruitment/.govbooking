<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Select Office — Appointment</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      margin: 0; padding: 0;
      display: flex; flex-direction: column; align-items: center;
    }
    .container {
      background: white;
      padding: 20px;
      margin: 40px auto;
      width: 90%;
      max-width: 700px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, p {
      text-align: center;
    }
    label {
      font-weight: bold;
      margin-top: 15px;
      display: block;
    }
    select, input[type="text"] {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }
    .office-details {
      background: #f1f1f1;
      padding: 15px;
      margin-top: 15px;
      border-radius: 6px;
      font-size: 14px;
      line-height: 1.5;
    }
    .buttons {
      margin-top: 25px;
      display: flex;
      justify-content: space-between;
    }
    button {
      padding: 12px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button.continue {
      background-color: #2a6d34;
      color: white;
    }
    button.back {
      background-color: #ccc;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Select a Branch / Office</h1>
    <p>Choose the location where you will attend for passport / ID services.</p>

    <label for="countrySelect">Filter by country</label>
    <select id="countrySelect">
      <option value="all">All Countries</option>
      <option value="Eswatini" selected>Eswatini</option>
      <!-- Add other countries if needed -->
    </select>

    <label for="searchInput">Search office (city, name)</label>
    <input type="text" id="searchInput" placeholder="Type a city or office name" />

    <label for="officeSelect">Choose Branch / Office</label>
    <select id="officeSelect" size="5" style="height: auto;">
      <!-- offices will be populated here -->
    </select>

    <div class="office-details" id="officeDetails">
      <!-- details shown here -->
    </div>

    <div class="buttons">
      <button class="continue" id="continueBtn" disabled>Continue</button>
      <button class="back" id="backBtn">Back</button>
    </div>
  </div>

<script>
  // Sample offices data
  const offices = [
    {
      country: "Eswatini",
      city: "Mbabane",
      name: "Ministry of Home Affairs & Justice - Main Office",
      address: "Mhlambanyatsi Usuthu Link Rd, Mbabane",
      phone: "+268 2404 2941",
      hours: "Mon-Fri 08:00 - 16:00",
      notes: "Primary national office. Verify hours before visiting."
    },
    {
      country: "Eswatini",
      city: "Manzini",
      name: "Manzini Regional Office",
      address: "123 Main Street, Manzini",
      phone: "+268 1234 5678",
      hours: "Mon-Fri 08:00 - 16:00",
      notes: "Regional office for Manzini area."
    },
    // Add more offices here as needed
  ];

  const countrySelect = document.getElementById('countrySelect');
  const searchInput = document.getElementById('searchInput');
  const officeSelect = document.getElementById('officeSelect');
  const officeDetails = document.getElementById('officeDetails');
  const continueBtn = document.getElementById('continueBtn');
  const backBtn = document.getElementById('backBtn');

  function filterOffices() {
    const countryFilter = countrySelect.value;
    const searchTerm = searchInput.value.trim().toLowerCase();

    const filtered = offices.filter(office => {
      const matchesCountry = countryFilter === 'all' || office.country === countryFilter;
      const matchesSearch = office.city.toLowerCase().includes(searchTerm) ||
                            office.name.toLowerCase().includes(searchTerm);
      return matchesCountry && matchesSearch;
    });

    populateOfficeDropdown(filtered);
  }

  function populateOfficeDropdown(list) {
    officeSelect.innerHTML = '';

    if (list.length === 0) {
      const option = document.createElement('option');
      option.text = 'No offices found';
      option.disabled = true;
      officeSelect.add(option);
      officeDetails.innerHTML = '';
      continueBtn.disabled = true;
      return;
    }

    list.forEach((office, index) => {
      const option = document.createElement('option');
      option.value = index;
      option.text = `${office.country} — ${office.city} — ${office.name}`;
      officeSelect.add(option);
    });

    officeSelect.selectedIndex = 0;
    showOfficeDetails(list[0]);
    continueBtn.disabled = false;
  }

  function showOfficeDetails(office) {
    if (!office) {
      officeDetails.innerHTML = '';
      continueBtn.disabled = true;
      return;
    }

    officeDetails.innerHTML = `
      <strong>${office.name} — ${office.city}, ${office.country}</strong><br/>
      <strong>Address:</strong> ${office.address}<br/>
      <strong>Phone:</strong> ${office.phone}<br/>
      <strong>Hours:</strong> ${office.hours}<br/>
      <strong>Notes:</strong> ${office.notes}
    `;
    continueBtn.disabled = false;
  }

  officeSelect.addEventListener('change', () => {
    const selectedIndex = officeSelect.value;
    const countryFilter = countrySelect.value;
    const searchTerm = searchInput.value.trim().toLowerCase();

    const filtered = offices.filter(office => {
      const matchesCountry = countryFilter === 'all' || office.country === countryFilter;
      const matchesSearch = office.city.toLowerCase().includes(searchTerm) ||
                            office.name.toLowerCase().includes(searchTerm);
      return matchesCountry && matchesSearch;
    });

    showOfficeDetails(filtered[selectedIndex]);
  });

  countrySelect.addEventListener('change', filterOffices);
  searchInput.addEventListener('input', filterOffices);

  backBtn.addEventListener('click', () => {
    window.history.back();
  });

  continueBtn.addEventListener('click', () => {
    const selectedIndex = officeSelect.value;
    if (selectedIndex === null || selectedIndex === '') {
      alert('Please select an office.');
      return;
    }

    // Save selected office data to localStorage or pass via query params
    const countryFilter = countrySelect.value;
    const searchTerm = searchInput.value.trim().toLowerCase();
    const filtered = offices.filter(office => {
      const matchesCountry = countryFilter === 'all' || office.country === countryFilter;
      const matchesSearch = office.city.toLowerCase().includes(searchTerm) ||
                            office.name.toLowerCase().includes(searchTerm);
      return matchesCountry && matchesSearch;
    });

    const selectedOffice = filtered[selectedIndex];
    localStorage.setItem('selectedOffice', JSON.stringify(selectedOffice));

    // Go to the next page where you can implement date/time selection
    window.location.href = 'select-date-time.html';
  });

  // Initial populate
  filterOffices();
</script>
</body>
</html>
